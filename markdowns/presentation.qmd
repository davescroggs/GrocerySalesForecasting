---
title: "CorporaciÃ³n Favorita Grocery Sales Forecasting"
subtitle: "A casestudy in modelling grocery sales in Ecuadorian supermarkets"
author: "David Scroggs"
date: "4-12-2022"
format: beamer
editor: visual
---

## Introduction

Accurate forecasting of product sales is important to retail stores, as stated in the competition description:

> *Predict a little over, and grocers are stuck with overstocked, perishable goods. Guess a little under, and popular items quickly sell out, leaving money on the table and customers fuming.*

Competition is to forecast item sales in:

-   54 different grocery stores in 22 cities

-   4,100 sale items

-   4.5 years, 125 million rows of training data

-   Forecast period of 2 weeks past final training data

## Data

Competition model data is 7 tables, test/train containing the predictor variable and 5 other tables containing additional information.

| Table        |      Rows | Columns | Column names                                              |
|:-----------------|-----------------:|-----------------:|:------------------|
| train        | 125497040 |       6 | id, date, store_nbr, item_nbr, unit_sales, onpromotion    |
| test         |   3370464 |       5 | id, date, store_nbr, item_nbr, onpromotion                |
| transactions |     83488 |       3 | date, store_nbr, transactions                             |
| items        |      4100 |       4 | item_nbr, family, class, perishable                       |
| oil          |      1218 |       2 | date, dcoilwtico                                          |
| holidays     |       350 |       6 | date, type, locale, locale_name, description, transferred |
| stores       |        54 |       5 | store_nbr, city, state, type, cluster                     |

## Evaluation metric

Normalized Weighted Root Mean Squared Logarithmic Error (NWRMSLE) is the evaluation metric

-   Wieght (wi) are for perishible items (weight = 1.5), other items weight = 1

-   Metric accounts for predicting results of a varying order of magnitude

$$ NWRMSLE = \sqrt{ \frac{\sum_{i=1}^{n} w_i \left( \ln(\hat{y}_i + 1) - \ln(y_i +1)  \right)^2  }{\sum_{i=1}^{n} w_i}} $$

## Model approach

1.   EDA

2.  Simple model

3. 

## Results

Final model - Tuned XGBoost

-   Features modelled - item number, store number, temporal information (weekday, month, year), store type, store cluster, location (state)
-   hyper-parameters tuned: tree depth, min data points in a node, randomly sampled predictors
-   Model evaluation: nwrmsle = 0.696

![Feature importance](../figures/final_model_feature_importance.jpeg)

## Residuals

-   Model tends to under-estimate the result
-   Stratification of residuals, particularly in higher unit sales

![Residuals](../figures/final_model_residuals.jpeg){width="250px"}

## Residual outliers

-   Holidays not included in model features
    -   Potential reason for some extreme outliers
-   Store results insensitive to increase in sales
-   Stores in 42, 49 large overestimates
    -   Only stores in Quito city, and Type C
    -   Both dummy features had high importance

![Extreme residuals](../figures/extreme_residuals.jpeg)

## Limitations


## Future work

## Production deployment considerations

